# Unity 游戏接入微信小游戏指南

​		本文档将介绍微信平台提供的各项转化能力的说明与指引，并告知开发者如何根据自己的游戏正确使用这些能力以达到最佳的游戏转化效果，开发者参考文档根据自己游戏所符合条件开始实践！

​		下图中介绍了接入过程中的流程，以及每一个阶段需要做的优化与配置，下文将介绍每一个阶段的工作：

![guide01](../image/guide/guide01.png)

### 首场景启动优化

> 详细手册：[提升Unity WebGL游戏启动速度]() 与 [首场景启动优化]()

​		以统计数据反馈，小游戏玩家对于游戏的启动时长是较为敏感的，过长的启动时间会导致用户的显著流失。

### 使用 AA/AB 包按需加载

> 详细手册：[AA(Addressable) 进行资源按需加载]() 与 [AB(AssetBundle)进行资源按需加载]()

​		区别于原生 APP 游戏很少考虑场景内的资源规划问题，开发时往往将资源在游戏启动时全加载到内存中，而小游戏中游戏“即点即玩”，游戏的呈现速度中诸如首资源包的下载往往占比较大，因此需要根据场景中的主次内容进行资源上的优化分包处理。再比如游戏若提供多个场景，还需要对场景的进行单独的打包在游戏中进行按需下载。

### 封面图配置

> 详细手册：[启动封面]()

​		由于 Unity WebGL 的启动加载需要一定的时间，微信小游戏支持通过配置封面图/视频等内容作为加载期间的过渡来留住玩家，微信小游戏支持如下自定义配置项：

- 封面图/视频内容
- 加载文案及样式
- 进度条样式
- 封面自动隐藏时机

### 资源预下载

> 详细手册：[使用预下载功能]()

​		在 UnityLoader 加载过程中是存在CPU处理密集而 **网络空闲** 的情况，因此可以充分利用该时机进行一些必要的资源下载可有助于提升游戏场景等资源的载入速度。

### 压缩纹理资源

> 详细手册： [压缩纹理优化]() 

​		压缩纹理工具是微信SDK提供的一种能够根据不同的游戏运行平台而按需加载压缩后纹理资源的能力。它的优点是：

- **增快游戏运行速度**：纹理资源从 bundle 内分离后按渲染需要进行后续加载，有效减少 bundle 体积，增快游戏的运行速度
- **减少内存占用，GPU硬解纹理渲染更快**： 分离的资源被压缩成多种格式的纹理资源在 CDN 中存储，客户端根据硬件 GPU 支持的格式按需下载渲染，体积更小，渲染速度更快

​		纹理压缩对于 **提升运行速度** 与 **减少内存** 的优化方面均有不错的表现效果，对于重度游戏而言，均建议进行该优化。



## 游戏分类

​		不同的游戏所需要的性能不尽相同，转化过程中的复杂度自然也是不同的。游戏开发者可以根据自己游戏的类型选择不同的转化方式满足实际的运行需求，本节列举的不同程度的游戏类型开发者根据指引完成对应的转化工作。

- 小型游戏

​		特点：游戏总包体积较小，“关卡”休闲类小游戏等。

​		转化：代价较低，较少变动即可满足运行要求。可采用 Unity Instant Game 方案快速转化。

- 原生 APP 平台采用本地 AB/AA 包的游戏

​		特点：游戏原本发布原生 APP 平台，开发时为优化运行时内存，将游戏资源以 AA/AB 包方式存放于磁盘本地，在游戏运行时适宜的位置进行加载/卸载。

​		转化：代价适中，将资源包托管至 CDN ，采用按需下载的方式运行。

- 大型无 AB 游戏

​		特点：游戏较大，但未使用 AA/AB 包方式进行分包管理，或较少使用，场景中必须与非必需资源在启动时一并加载。

​		转化：需要进行专项的适配工作来满足小游戏环境下的运行条件，对内存规划更为严格，内存优化工作需要进行专项的调整。



